<%- include('.././header.ejs') %>
<%- include('./layout/navbar.ejs') %>
    <h2>Transactions: <%= transactions.length %></h2>
    <div class="row">
        <% transactions.forEach(transaction => { %>    
            <% if (transaction.isCancelled === true && transaction.isRefunded === true) { %>
                <div class="col-lg-4 col-12 col-sm-6" style="background-color: #E29578;">
                <h5>Transaction Status: Refunded Cancelled</h5>
            <% } else if (transaction.isCancelled === true && transaction.isRefunded === false) { %>
                <div class="col-lg-4 col-12 col-sm-6" style="background-color: #E29578;">
                <h5>Transaction Status: Unrefunded Cancelled</h5>
            <% } else if (transaction.isWithinAday === true && transaction.isTransactionComplete === false) { %>
                <div class="col-lg-4 col-12 col-sm-6" style="background-color: #83C5BE;">
                <h5>Transaction Status: Today</h5>
            <% } else if (transaction.isTransactionComplete === true) { %>
                <div class="col-lg-4 col-12 col-sm-6" style="background-color: #83C5BE;">
                <h5>Transaction Status: Completed</h5>
            <% } else { %>
                <div style="background-color: #83C5BE; color: black;">
                <h5>Transaction Status: Pending</h5>
            <% } %>
                <div class="mb-4 shadow-sm">
                        <h6 class="card-title">Transaction ID: <%= transaction._id %></h6>
                        <div class="accordion accordion-flush" id="accordionFlushExample">
                            <div class="accordion-item">
                              <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseOne" aria-expanded="false" aria-controls="flush-collapseOne">
                                  Profile
                                </button>
                              </h2>
                              <div id="flush-collapseOne" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
                                <div class="accordion-body">
                                    <ul>
                                        <li>Username: <%= transaction.customer.username %></li>
                                        <li>Fullname: <%= transaction.customer.fullname %></li>
                                        <%
                                            const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
                                            const birthDate = new Date(transaction.customer.dateOfBirth);
                                            const formattedBirthDate = `${months[birthDate.getMonth()]} ${birthDate.getDate()} ${birthDate.getFullYear()}`;
                                        %>
                                        <li>Date of Birth: <%= formattedBirthDate %></li>
                                    </ul>
                                </div>
                              </div>
                            </div>
                            <div class="accordion-item">
                              <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwo" aria-expanded="false" aria-controls="flush-collapseTwo">
                                  Orders
                                </button>
                              </h2>
                              <div id="flush-collapseTwo" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
                                <div class="accordion-body">
                                    <ul>
                                        <% transaction.cart.items.forEach(item => { %>
                                            <li><%= item.product.name %> <%= item.quantity %>x</li>
                                        <% }) %>
                                    </ul>
                                </div>
                              </div>
                            </div>
                            <div class="accordion-item">
                              <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseThree" aria-expanded="false" aria-controls="flush-collapseThree">
                                  Reservation
                                </button>
                              </h2>
                              <div id="flush-collapseThree" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
                                <div class="accordion-body">
                                    <ul>
                                        <%
                                            const monthz = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
                                            const reservation = new Date(transaction.reservation.reservation_date);
                                            const formattedReservationDate = `${monthz[reservation.getMonth()]} ${reservation.getDate()} ${reservation.getFullYear()}`;
                                        %>
                                        <li>Reservation date: <%= formattedReservationDate %></li>
                                        <li>Reservation time: <span class="reservation-time"><%= transaction.reservation.reservation_time %></span></li>
                                        <li>Number of Pax: <%= transaction.reservation.num_pax %></span></li>
                                        <li>Notes: <%= transaction.reservation.notes %></span></li>
                                        <li>Amount: â‚±<%= transaction.reservation.amount %></span></li>
                                        <li>created at: <%= transaction.reservation.created_at.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: '2-digit', year: 'numeric' }) %></li>
                                    </ul>
                                </div>
                                
                              </div>
                              
                            </div>
                            <a href="/restaurant/delete-transaction/<%= transaction._id %>" class="btn btn-danger btn-sm">Delete</a>
                            <% if (transaction.isCancelled === false && transaction.isTransactionComplete === false) { %>
                                <form action="/restaurant/transaction-complete/<%= transaction._id %>" method="post">
                                    <button type="submit" class="btn btn-primary btn-sm">Transaction completed</button>
                                </form>
                            <% } %>
                        </div>
                </div>
            </div>
        <% }); %>
    </div>

    

<script src="/js/restaurant/dashboard.js"></script> 
<script src="/js/timeFormatting.js"></script> 
<%- include('.././footer.ejs') %>
